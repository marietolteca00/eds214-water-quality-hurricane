---
title: "Marie's Reproducibility"
format:
  html: 
    output-file: "index.html"
editor_options: 
  chunk_output_type: console

---

## Background
Following the water quality after hurricane hugo occurred in September 22, 1989. Schaefer et al. (2000) investigated a long-term stream water quality in Puerto Rico before and after the 1989 Hurricane Hugo. The investigation led to finding chemical concentrations such as calcium, nitrate, phosphate, potassium, and magnesium. The  chemical potassium increased after the hurricane and stayed elevated for a few years after.


## Data 
Start loading in libraries and load in data from EDI website provided in the README.md file. To view the way the data was imported check the outputs folder, 'data_imports.RDS'
```{r, message=FALSE}
library(here)
library(tidyverse)

data_imports <- readRDS(here::here("outputs", "data_imports.RDS"))
```


## Methods
For methods the approach taken was to combine all four dataframes into one to and start selecting, mutating, filtering, arrange, and pivot longer. This is saved on the *intermediate results folder*, use *'data_imports.R'* to view how the data was cleaned. As well as use a function created for all concentrations (Rolling_average.R) saved under the R folder. 
```{r}
rolling_avg <- readRDS(here::here("outputs", "rolling_avg_1.RDS"))
```


# Results
During the process of cleaning and organizing the data, a plot was created to visualize what the findings are. The plot will be saved into the 'figs' folder under 'Concentrations_plot'
```{r, warning =FALSE}
# PLOT for Concentrations
p1 <- ggplot(data= rolling_avg, aes(x= sample_date, y=concentration )) + # nh4
  
  # plot as line
  geom_line(aes(linetype = sample_id)) + # sample_id does not auto populate
  facet_wrap(~stream_ion, scales = "free_y", ncol=1,
             strip.position = "left",
             
             # Using labeller to 
             labeller = as_labeller(c(nh4_n = "NH4 -N ug l -1",
            ca = "Ca mg l -1",
            mg = "Mg mg l-1",
            no3_n = "NO3 -N ug l-1",
            k = "K mg l-1")))+

  # Add a vertical line to plot - Event of Hurricane Hugo
  geom_vline(xintercept = as.Date("1989-09-22"), linetype = "dashed", color = "red")+
  
  # Adding and Editinng labels 
  labs(x = "Year",
       y = "Concentration Measured by ug/L",
       title = "Chemical Balance after Hurricane Hugo",
       subtitle = "Hurrican Hugo happened on 1989-09-22",
       linetype = "Site") +
  
  # Adding Theme
  theme_bw()+
  
  
  # Settings for alignment
  theme(strip.position = "outside",
    plot.title = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    strip.text = element_text(size =8))


# Printing plot to view
print(p1)

# Save the Plot as a PNG
ggsave(here("figs", "Concentrations_plot.png"),
       p1,
      width = 6, height = 5)


```

With the results we can see that all concentrations fluctuated within a decade after the Hurricane Hugo.
